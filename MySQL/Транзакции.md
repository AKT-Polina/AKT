#mysql
Транзакции в MySQL - это механизм для группировки нескольких операций базы данных в единую логическую единицу работы. Транзакции обеспечивают целостность данных и надежность в случае сбоев в работе приложения или сервера базы данных.

Применение транзакций в MySQL включает следующие основные этапы:

1. Начало транзакции - это начало блока кода, в котором выполняются операции с базой данных в рамках одной транзакции. Начало транзакции выполняется командой "START TRANSACTION".

2. Выполнение операций - внутри блока кода транзакции выполняются операции с базой данных, такие как вставка, обновление или удаление записей.

3. Фиксация изменений - после того, как все операции были выполнены успешно, изменения фиксируются в базе данных командой "COMMIT". Это означает, что изменения становятся постоянными и доступными для чтения другими пользователями.

4. Откат изменений - если при выполнении операций произошла ошибка, то изменения могут быть отменены и база данных возвращается к состоянию, которое было до начала транзакции. Отмена изменений выполняется командой "ROLLBACK".

Пример применения транзакций в MySQL:

```sql
START TRANSACTION;

UPDATE users SET balance = balance - 100 WHERE id = 1;
UPDATE users SET balance = balance + 100 WHERE id = 2;

COMMIT;
```

В данном примере выполняется перевод средств со счета пользователя с id=1 на счет пользователя с id=2. Если выполнение операций завершится успешно, то изменения будут сохранены в базе данных командой COMMIT. Если при выполнении операций произойдет ошибка, то изменения будут отменены командой ROLLBACK, и база данных вернется к исходному состоянию.

### SAVEPOINT

Savepoint - это механизм в MySQL, который позволяет сохранить состояние транзакции на определенном этапе выполнения и в случае необходимости откатить изменения только до этого момента, не откатывая всю транзакцию.

Применение savepoint в MySQL включает следующие основные этапы:

1. Начало транзакции - это начало блока кода, в котором выполняются операции с базой данных в рамках одной транзакции. Начало транзакции выполняется командой "START TRANSACTION".

2. Выполнение операций - внутри блока кода транзакции выполняются операции с базой данных, такие как вставка, обновление или удаление записей.

3. Создание savepoint - на определенном этапе выполнения операций может быть создан savepoint, который будет сохранять состояние транзакции. Создание savepoint выполняется командой "SAVEPOINT savepoint_name".

4. Продолжение выполнения операций - после создания savepoint можно продолжать выполнение операций.

5. Откат до savepoint - если при выполнении операций произойдет ошибка и необходимо откатить изменения, то можно выполнить откат до savepoint, сохраняя изменения, выполненные после создания savepoint. Откат до savepoint выполняется командой "ROLLBACK TO savepoint_name".

6. Фиксация изменений - после того, как все операции были выполнены успешно, изменения фиксируются в базе данных командой "COMMIT". Это означает, что изменения становятся постоянными и доступными для чтения другими пользователями.

Пример применения savepoint в MySQL:

```sql
START TRANSACTION;

UPDATE users SET balance = balance - 100 WHERE id = 1;
SAVEPOINT sp1;
UPDATE users SET balance = balance + 100 WHERE id = 2;

-- Ошибка при выполнении следующей операции
UPDATE users SET balance = balance + 100 WHERE id = 3;

ROLLBACK TO sp1;

-- Продолжение выполнения операций
UPDATE users SET balance = balance + 50 WHERE id = 4;

COMMIT;
```

В данном примере выполняется перевод средств со счета пользователя с id=1 на счет пользователя с id=2, после чего создается savepoint sp1. Затем выполняется операция по переводу средств со счета пользователя с id=1 на счет пользователя с id=3, при выполнении которой происходит ошибка. В этом случае можно выполнить откат до savepoint sp1, сохраняя изменения, выполненные после его создания, и продолжить выполнение операций.