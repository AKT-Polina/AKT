#mysql
Полнотекстовый поиск - это метод поиска, который позволяет искать в базе данных не только по точному совпадению слов, но и по похожим словам, синонимам и другим отношениям между словами.

## Полнотекстовый индекс

Полнотекстовый индекс - это индекс, который позволяет осуществлять полнотекстовый поиск по текстовым полям в базе данных. Этот тип индекса позволяет эффективно искать строки в больших объемах текста, включая простые и составные слова, фразы и операции логического поиска.

Полнотекстовый индекс создается на одном или нескольких столбцах таблицы, которые содержат текстовую информацию, и используется в сочетании с функцией MATCH() в SQL-запросах для выполнения полнотекстового поиска.

При создании полнотекстового индекса в MySQL можно задать параметры индекса, которые определяют, каким образом индекс будет создаваться и какие оптимизации будут использоваться для ускорения поиска.

Чтобы создать полнотекстовый индекс в MySQL, необходимо выполнить следующие шаги:

1. Создать таблицу, содержащую текстовые столбцы, на которые будет установлен индекс:

```sql
CREATE TABLE my_table (
  id INT NOT NULL AUTO_INCREMENT,
  text_column1 TEXT,
  text_column2 TEXT,
  PRIMARY KEY (id)
);
```

2. Создать полнотекстовый индекс на необходимых столбцах. Для этого используется оператор FULLTEXT:

```sql
ALTER TABLE my_table ADD FULLTEXT(text_column1, text_column2);
```

После выполнения этой команды MySQL создаст полнотекстовый индекс на столбцах `text_column1` и `text_column2` таблицы `my_table`.

При создании индекса можно задать дополнительные параметры, такие как минимальную длину слов, которые будут включены в индекс, и список слов, которые будут проигнорированы. Например:

```
ALTER TABLE my_table ADD FULLTEXT(text_column1, text_column2) 
  WITH MIN_LENGTH=3, STOPWORDS='english';
```

Эта команда создаст индекс на столбцах `text_column1` и `text_column2`, включая только слова, длина которых не менее 3 символов, и игнорируя предлоги и союзы на английском языке.

3. После создания индекса можно использовать функцию MATCH() в SQL-запросах для выполнения полнотекстового поиска. Например:

```
SELECT * FROM my_table WHERE MATCH(text_column1, text_column2) AGAINST ('search query');
```

Эта команда выполнит поиск всех строк в таблице `my_table`, содержащих слова из запроса 'search query' в столбцах `text_column1` и `text_column2`. Результаты будут отсортированы по релевантности поисковому запросу.


## MATCH()

Функция MATCH() используется для выполнения полнотекстового поиска в столбцах таблицы базы данных. Она ищет в столбце совпадения с заданным поисковым запросом и возвращает результаты, отсортированные по релевантности.

MATCH() принимает два аргумента: имя столбца таблицы, в котором выполняется поиск, и поисковый запрос.

Например, функция MATCH() может использоваться для выполнения следующих операций:

- Поиск всех строк, которые содержат слова из поискового запроса
- Сортировка результатов по убыванию релевантности
- Использование операторов расширенного поиска, таких как "+", "-", "\" и др.

Примеры использования функции MATCH():

1. Поиск всех строк в таблице "articles", которые содержат слова "database" и "management":

``SELECT * FROM articles WHERE MATCH(content) AGAINST('database management');

2. Сортировка результатов поиска в таблице "products" по убыванию релевантности:

``SELECT * FROM products WHERE MATCH(name) AGAINST('computer hardware') ORDER BY MATCH(name) DESC;

3. Использование операторов расширенного поиска для поиска в таблице "users" строк, которые содержат слово "John" и не содержат слово "Doe":

``SELECT * FROM users WHERE MATCH(name) AGAINST('+John -Doe');

Для поиска совпадений **по двум столбцам** в таблице можно использовать оператор CONCAT(), который объединяет значения столбцов в одну строку. Затем можно применить функцию MATCH() для поиска совпадений в объединенной строке.

Например, предположим, что у вас есть таблица `my_table`, которая содержит два текстовых столбца: `column1` и `column2`. Чтобы осуществить поиск совпадений в обоих столбцах, можно использовать следующий запрос:

```sql
SELECT * FROM my_table
WHERE MATCH(CONCAT(column1, ' ', column2)) AGAINST ('search query');
```

Этот запрос объединяет значения столбцов `column1` и `column2` с помощью функции CONCAT() и добавляет между ними пробел, чтобы создать одну строку. Затем он применяет функцию MATCH() для выполнения полнотекстового поиска в объединенной строке. В результате будут найдены все строки, содержащие совпадения с запросом "search query" в столбцах `column1` и `column2`.

Обратите внимание, что в этом примере мы использовали пробел между значениями столбцов в функции CONCAT(). Это связано с тем, что в полнотекстовом поиске MySQL использует пробелы для разделения слов, поэтому мы должны добавить пробел между значениями столбцов, чтобы создать правильную строку для поиска.



## AGAINST()

AGAINST() - это ключевое слово, используемое в MySQL для выполнения полнотекстового поиска с использованием функции MATCH(). Оно принимает поисковый запрос в качестве аргумента и ищет совпадения в указанном столбце таблицы.

AGAINST() может использоваться с различными параметрами для настройки поискового запроса, такими как режимы поиска (BOOLEAN, NATURAL LANGUAGE, EXPANSION), операторы (AND, OR, NOT), кавычки для поиска точных фраз и т.д.

Например, пример запроса с использованием AGAINST():

``SELECT * FROM mytable WHERE MATCH (mycolumn) AGAINST ('search query' IN BOOLEAN MODE);

В данном примере мы ищем все строки таблицы "mytable", которые содержат в столбце "mycolumn" совпадения с поисковым запросом "search query" в режиме BOOLEAN.

Кроме того, можно использовать простой синтаксис, где AGAINST() принимает только поисковый запрос без дополнительных параметров:

``SELECT * FROM mytable WHERE MATCH (mycolumn) AGAINST ('search query');

В этом случае MySQL будет использовать настройки по умолчанию для полнотекстового поиска.

## Режимы поиска

В MySQL для выполнения полнотекстового поиска с помощью функции MATCH() существуют три режима поиска: BOOLEAN MODE, NATURAL LANGUAGE MODE и EXPANSION MODE. Каждый режим поиска имеет свои особенности и может быть выбран в зависимости от конкретной задачи поиска.

1. BOOLEAN MODE - режим поиска, который позволяет использовать операторы, такие как AND, OR, NOT, и операторы расширенного поиска, такие как +, -, *, "". В этом режиме поиска результаты сортируются по количеству совпадений. Пример использования:

``SELECT * FROM mytable WHERE MATCH(mycolumn) AGAINST('search query' IN BOOLEAN MODE);

2. NATURAL LANGUAGE MODE - режим поиска, который позволяет использовать естественный язык для поиска. Он автоматически определяет, какие слова являются наиболее значимыми в поисковом запросе, игнорирует общие слова и нечеткие совпадения. Результаты сортируются по релевантности. Пример использования:

``SELECT * FROM mytable WHERE MATCH(mycolumn) AGAINST('search query' IN NATURAL LANGUAGE MODE);

3. EXPANSION MODE - режим поиска, который используется для поиска по синонимам и словоформам. В этом режиме MySQL автоматически расширяет поисковый запрос, добавляя к нему синонимы и словоформы, что может привести к расширению результатов поиска. Пример использования:

``SELECT * FROM mytable WHERE MATCH(mycolumn) AGAINST('search query' WITH QUERY EXPANSION);

## BOOLEAN MODE

Для использования BOOLEAN MODE в функции MATCH() нужно добавить ключевое слово "IN BOOLEAN MODE" после выражения поиска. Например:

SELECT * FROM mytable WHERE MATCH(mycolumn) AGAINST('search query' IN BOOLEAN MODE);

В BOOLEAN MODE используется следующий синтаксис для операторов:

1. Оператор AND:
   Оператор AND позволяет искать строки, содержащие оба слова в поисковом запросе. Например, запрос "apple AND orange" вернет строки, содержащие оба слова "apple" и "orange".

2. Оператор OR:
   Оператор OR позволяет искать строки, содержащие хотя бы одно из слов в поисковом запросе. Например, запрос "apple OR orange" вернет строки, содержащие слово "apple", слово "orange" или оба слова.

3. Оператор NOT:
   Оператор NOT позволяет искать строки, не содержащие слово, указанное в запросе. Например, запрос "apple NOT orange" вернет строки, содержащие слово "apple", но не содержащие слово "orange".

4. Оператор "+" (знак плюс):
   Оператор "+" указывает, что слово является обязательным для вхождения в результаты поиска. Например, запрос "apple +orange" вернет строки, содержащие слово "apple" и обязательно слово "orange".

5. Оператор "-" (знак минус):
   Оператор "-" указывает, что слово должно быть исключено из результатов поиска. Например, запрос "apple -orange" вернет строки, содержащие слово "apple", но не содержащие слово "orange".

6. Оператор "*" (знак звездочки):
   Оператор "*" указывает, что слово должно быть найдено в любой форме. Например, запрос "appl*" вернет строки, содержащие слова "apple", "application", "applied" и т.д.

7. Оператор "" (двойные кавычки):
   Оператор "" указывает, что поиск должен быть выполнен по точной фразе, указанной в кавычках. Например, запрос ""apple juice"" вернет строки, содержащие точную фразу "apple juice".

При использовании BOOLEAN MODE в функции MATCH() важно учитывать порядок операторов и выражений, чтобы получить нужные результаты. Также следует учитывать, что использование BOOLEAN MODE может замедлить производительность запроса,



